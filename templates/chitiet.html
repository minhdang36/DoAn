<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ phong.ten }} - Tr·ªç Sinh Vi√™n</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <header>
        <div class="header-top">
            <div class="page-title">Tr·ªç Sinh Vi√™n</div>
            <div class="header-actions">
                {% if current_user.is_authenticated %}
                    <span class="user-hello">Hi, {{ current_user.full_name }}</span>
                    {% if current_user.role == 'student' %}
                        <a href="/lich-su" class="btn-header">L·ªãch s·ª≠</a>
                    {% endif %}
                    {% if current_user.role == 'landlord' or current_user.role == 'admin' %}
                        <a href="/quanlytin" class="btn-header" style="background-color: #f39c12; color: white;">Qu·∫£n l√Ω</a>
                    {% endif %}
                    <a href="/profile" class="btn-header">H·ªì s∆°</a>
                    <a href="/logout" class="btn-header" style="background-color: #7f8c8d; color: white;">Tho√°t</a>
                {% else %}
                    <a href="/login" class="btn-header">ƒêƒÉng Nh·∫≠p</a>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="detail-container">
        <a href="/" class="btn-back"><i class="fa-solid fa-arrow-left"></i> Quay l·∫°i danh s√°ch</a>

        <div class="detail-layout">
            
            <div class="detail-left">
                
                <div class="detail-image">
                    <img src="/static/images/{{ phong.anh }}" alt="·∫¢nh ph√≤ng tr·ªç">
                    {% if phong.status == 'da_thue' %}
                        <div class="overlay-status">ƒê√É H·∫æT PH√íNG</div>
                    {% endif %}
                </div>

                <div class="info-section">
                    <div class="room-header">
                        <h1 class="room-title">{{ phong.ten }}</h1>
                        {% if phong.status == 'da_thue' %}
                            <span class="badge-status het-phong">üö´ ƒê√£ cho thu√™</span>
                        {% else %}
                            <span class="badge-status con-phong">‚úÖ C√≤n ph√≤ng</span>
                        {% endif %}
                    </div>

                    <div class="room-meta">
                        <span class="room-price">{{ "{:,.0f}".format(phong.gia|float).replace(",", ".") }} VNƒê/th√°ng</span>
                    </div>
                    
                    <p class="room-address"><i class="fa-solid fa-location-dot" style="color: #e74c3c;"></i> {{ phong.dia_chi }}</p>
                    
                    <hr>
                    
                    <h3>M√¥ t·∫£ chi ti·∫øt</h3>
                    <div class="room-desc">
                        {{ phong.mo_ta }}
                    </div>
                </div>

                <div class="comment-section">
                    <h3>üí¨ ƒê√°nh gi√° & B√¨nh lu·∫≠n</h3>
                    
                    {% if current_user.is_authenticated and current_user.role == 'student' %}
                    <form action="/gui_binh_luan/{{ phong.id }}" method="POST" class="comment-form">
                        <div class="form-row">
                            <label><i class="fa-solid fa-star" style="color: #f1c40f;"></i> ƒê√°nh gi√°:</label>
                            <select name="rating" class="rating-select">
                                <option value="5">5 Sao - Tuy·ªát v·ªùi</option>
                                <option value="4">4 Sao - T·ªët</option>
                                <option value="3">3 Sao - B√¨nh th∆∞·ªùng</option>
                                <option value="2">2 Sao - T·ªá</option>
                                <option value="1">1 Sao - R·∫•t t·ªá</option>
                            </select>
                        </div>
                        <textarea name="noi_dung" rows="3" class="comment-input" placeholder="Chia s·∫ª tr·∫£i nghi·ªám th·ª±c t·∫ø c·ªßa b·∫°n v·ªÅ ph√≤ng n√†y..." required></textarea>
                        <button type="submit" class="btn-submit-comment">G·ª≠i ƒê√°nh Gi√°</button>
                    </form>
                    {% endif %}

                    <div class="comment-list">
                        {% for bl in binh_luan %}
                        <div class="comment-item">
                            <div class="comment-avatar">{{ bl.full_name[0] }}</div>
                            <div class="comment-content">
                                <div class="comment-header">
                                    <strong>{{ bl.full_name }}</strong>
                                    <div class="stars">
                                        {% for i in range(bl.rating) %}<i class="fa-solid fa-star"></i>{% endfor %}
                                    </div>
                                </div>
                                <p>{{ bl.noi_dung }}</p>
                                <small class="comment-date">{{ bl.created_at }}</small>
                            </div>
                        </div>
                        {% else %}
                            <p class="no-comment">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="detail-right">
                <div class="owner-card">
                    <h3>Th√¥ng tin ch·ªß tr·ªç</h3>
                    <div class="owner-profile">
                        <div class="owner-avatar-img">üë§</div>
                        <div class="owner-text">
                            <strong>{{ phong.full_name }}</strong>
                            <p>Ch·ªß nh√† uy t√≠n</p>
                        </div>
                    </div>

                    {% if phong.phone %}
                        <div class="contact-buttons">
                            <a href="tel:{{ phong.phone }}" class="btn-contact call">
                                <i class="fa-solid fa-phone"></i> G·ªçi ƒëi·ªán
                            </a>
                            <a href="https://zalo.me/{{ phong.phone }}" target="_blank" class="btn-contact zalo">
                                <i class="fa-solid fa-comment"></i> Zalo
                            </a>
                        </div>
                    {% endif %}

                    <hr>

                    {% if phong.status != 'da_thue' %}
                        {% if current_user.is_authenticated and current_user.role == 'student' %}
                            <h4>Nh·∫Øn tin cho ch·ªß nh√†</h4>
                            <form action="/gui_lien_he/{{ phong.id }}" method="POST">
                                <textarea name="message" rows="4" class="msg-input" placeholder="V√≠ d·ª•: Em mu·ªën h·∫πn xem ph√≤ng v√†o 5h chi·ªÅu nay..." required></textarea>
                                <button type="submit" class="btn-contact send">
                                    <i class="fa-regular fa-paper-plane"></i> G·ª≠i y√™u c·∫ßu
                                </button>
                            </form>
                        {% elif not current_user.is_authenticated %}
                            <div class="login-prompt">
                                <p>B·∫°n mu·ªën thu√™ ph√≤ng n√†y?</p>
                                <a href="/login" class="btn-contact login">ƒêƒÉng nh·∫≠p ƒë·ªÉ li√™n h·ªá</a>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert-box">
                            ‚ö†Ô∏è Ph√≤ng n√†y ƒë√£ h·∫øt.
                        </div>
                    {% endif %}
                </div>
            </div>

        </div>
    </main>
</body>
</html>