{% extends "layout.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow rounded-4 p-4 p-md-5">
                
                <div class="text-center mb-4">
                    <h2 class="fw-bold text-primary"><i class="fa-solid fa-pen-to-square"></i> Ch·ªânh S·ª≠a Tin ƒêƒÉng</h2>
                </div>

                <form method="POST" enctype="multipart/form-data" id="form-sua-tin">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Ti√™u ƒë·ªÅ tin</label>
                        <input type="text" name="ten" value="{{ phong.ten }}" class="form-control bg-light border-0 rounded-3 py-2" required maxlength="255">
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Gi√° thu√™ (VNƒê)</label>
                            <input type="text" name="gia" id="gia-input" 
                                   value="{{ '{:.0f}'.format(phong.gia|float) }}"
                                   class="form-control bg-light border-0 rounded-3 py-2 fw-bold text-primary" 
                                   required maxlength="20" autocomplete="off">
                            <small id="doc-so-tien" class="fw-bold fst-italic text-success ms-1" style="font-size: 12px;"></small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Di·ªán t√≠ch (m¬≤)</label>
                            <input type="number" name="dien_tich" value="{{ phong.dien_tich }}" class="form-control bg-light border-0 rounded-3 py-2" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Lo·∫°i ph√≤ng</label>
                            <select name="loai_phong" class="form-select bg-light border-0 rounded-3 py-2" required>
                                <option value="Kh√©p k√≠n" {% if phong.loai_phong == 'Kh√©p k√≠n' %}selected{% endif %}>Kh√©p k√≠n</option>
                                <option value="Chung c∆∞" {% if phong.loai_phong == 'Chung c∆∞' %}selected{% endif %}>Chung c∆∞ mini</option>
                                <option value="Tr·ªç" {% if phong.loai_phong == 'Tr·ªç' %}selected{% endif %}>Tr·ªç gi√° r·∫ª</option>
                                <option value="Nguy√™n cƒÉn" {% if phong.loai_phong == 'Nguy√™n cƒÉn' %}selected{% endif %}>Nh√† nguy√™n cƒÉn</option>
                                <option value="KTX" {% if phong.loai_phong == 'KTX' %}selected{% endif %}>KTX / Homestay</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">ƒê·ªãa ch·ªâ chi ti·∫øt</label>
                        <input type="text" name="dia_chi" value="{{ phong.dia_chi }}" class="form-control bg-light border-0 rounded-3 py-2" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">M√¥ t·∫£ ti·ªán √≠ch</label>
                        <textarea name="mo_ta" rows="5" class="form-control bg-light border-0 rounded-3">{{ phong.mo_ta }}</textarea>
                    </div>

                    <div class="alert alert-warning d-flex align-items-center mb-4 p-2 rounded-3" role="alert">
                        <i class="fa-solid fa-circle-info me-2 fs-5"></i>
                        <small>Hi·ªán t·∫°i h·ªá th·ªëng ch∆∞a h·ªó tr·ª£ thay ƒë·ªïi h√¨nh ·∫£nh ho·∫∑c ti·ªán √≠ch khi s·ª≠a tin.</small>
                    </div>

                    <div class="d-flex gap-3">
                        <a href="/quanlytin" class="btn btn-light rounded-pill py-3 px-4 fw-bold shadow-sm flex-grow-1">H·ªßy b·ªè</a>
                        <button type="submit" class="btn btn-primary rounded-pill py-3 px-4 fw-bold shadow-sm flex-grow-1 hover-up">
                            <i class="fa-solid fa-floppy-disk me-2"></i> L∆∞u Thay ƒê·ªïi
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<script>
    const giaInput = document.getElementById('gia-input');
    const docSoText = document.getElementById('doc-so-tien');
    const form = document.getElementById('form-sua-tin');

    function formatMoney(value) {
        if (!value) return '';
        let rawValue = value.toString().replace(/\D/g, '');
        return new Intl.NumberFormat('vi-VN').format(rawValue);
    }

    window.addEventListener('DOMContentLoaded', () => {
        giaInput.value = formatMoney(giaInput.value);
    });

    giaInput.addEventListener('input', function(e) {
        let rawValue = this.value.replace(/\D/g, '');
        if (rawValue === '') {
            this.value = '';
            docSoText.innerText = '';
            return;
        }
        this.value = formatMoney(rawValue);
        let num = parseInt(rawValue);
        if (num >= 1000000) {
            let trieu = (num / 1000000).toFixed(1).replace('.0', '');
            docSoText.innerText = `üëâ ${trieu} tri·ªáu ƒë·ªìng`;
        } else if (num >= 1000) {
            let nghin = (num / 1000).toFixed(0);
            docSoText.innerText = `üëâ ${nghin} ngh√¨n ƒë·ªìng`;
        } else {
            docSoText.innerText = '';
        }
    });

    form.addEventListener('submit', function(e) {
        let rawValue = giaInput.value.replace(/\./g, ''); 
        giaInput.value = rawValue; 
    });
</script>
{% endblock %}