{% extends "layout.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow rounded-4 p-4 p-md-5">
                
                <div class="text-center mb-4">
                    <h2 class="fw-bold text-primary"><i class="fa-solid fa-pen-to-square"></i> ƒêƒÉng Tin Ph√≤ng Tr·ªç</h2>
                    <p class="text-muted">Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªÉ thu h√∫t sinh vi√™n thu√™ ph√≤ng nhanh nh·∫•t.</p>
                </div>

                <form action="/dangtin" method="POST" enctype="multipart/form-data" id="form-dang-tin">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Ti√™u ƒë·ªÅ tin (T·ªëi ƒëa 255 k√Ω t·ª±)</label>
                        <input type="text" name="ten" class="form-control bg-light border-0 rounded-3 py-2" 
                               placeholder="VD: Ph√≤ng tr·ªç gi√° r·∫ª B√°ch Khoa, ƒë·∫ßy ƒë·ªß ti·ªán nghi..." required maxlength="255">
                    </div>

                    <div class="row g-3 mb-3">
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Gi√° thu√™ (VNƒê)</label>
                            <input type="text" name="gia" id="gia-input" 
                                   class="form-control bg-light border-0 rounded-3 py-2 fw-bold text-primary" 
                                   placeholder="VD: 3.000.000" required maxlength="20" autocomplete="off">
                            <small id="doc-so-tien" class="fw-bold fst-italic text-success ms-1" style="font-size: 12px;"></small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Di·ªán t√≠ch (m¬≤)</label>
                            <input type="number" name="dien_tich" class="form-control bg-light border-0 rounded-3 py-2" placeholder="25" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label fw-bold">Lo·∫°i ph√≤ng</label>
                            <select name="loai_phong" class="form-select bg-light border-0 rounded-3 py-2" required>
                                <option value="">-- Ch·ªçn --</option>
                                <option value="Kh√©p k√≠n">Kh√©p k√≠n</option>
                                <option value="Chung c∆∞">Chung c∆∞ mini</option>
                                <option value="Tr·ªç">Tr·ªç gi√° r·∫ª</option>
                                <option value="Nguy√™n cƒÉn">Nh√† nguy√™n cƒÉn</option>
                                <option value="KTX">KTX / Homestay</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">Ti·ªán √≠ch c√≥ s·∫µn</label>
                        <div class="row g-2">
                            {% if ds_tien_ich %}
                                {% for ti in ds_tien_ich %}
                                <div class="col-6 col-md-4">
                                    <div class="form-check p-2 border rounded-3 bg-white">
                                        <input class="form-check-input ms-1" type="checkbox" name="tien_ich" value="{{ ti.id }}" id="ti_{{ ti.id }}">
                                        <label class="form-check-label d-flex align-items-center gap-2 ms-2 cursor-pointer" for="ti_{{ ti.id }}">
                                            <i class="fa-solid {{ ti.icon }} text-primary"></i> {{ ti.ten_tien_ich }}
                                        </label>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <p class="text-muted small">Ch∆∞a c√≥ ti·ªán √≠ch n√†o trong h·ªá th·ªëng.</p>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">ƒê·ªãa ch·ªâ chi ti·∫øt</label>
                        <input type="text" name="dia_chi" class="form-control bg-light border-0 rounded-3 py-2" placeholder="S·ªë nh√†, ng√µ, t√™n ƒë∆∞·ªùng, qu·∫≠n..." required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-bold">M√¥ t·∫£ th√™m</label>
                        <textarea name="mo_ta" rows="5" class="form-control bg-light border-0 rounded-3" placeholder="V√≠ d·ª•: Gi·ªù gi·∫•c t·ª± do, ƒëi·ªán n∆∞·ªõc gi√° d√¢n..."></textarea>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <label class="form-label fw-bold">·∫¢nh b√¨a (B·∫Øt bu·ªôc)</label>
                            <input type="file" name="hinh_anh" class="form-control border-0 bg-light rounded-3" accept="image/*" required>
                            <div class="form-text small">·∫¢nh n√†y s·∫Ω hi·ªán ngo√†i trang ch·ªß.</div>
                        </div>
                        
                        <div class="col-md-6">
                            <label class="form-label fw-bold">·∫¢nh chi ti·∫øt (Ch·ªçn nhi·ªÅu)</label>
                            <input type="file" name="anh_phu" class="form-control border-0 bg-light rounded-3" accept="image/*" multiple>
                            <div class="form-text small">Gi·ªØ ph√≠m <strong>Ctrl</strong> (ho·∫∑c Command) ƒë·ªÉ ch·ªçn nhi·ªÅu ·∫£nh c√πng l√∫c.</div>
                        </div>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary rounded-pill py-3 fw-bold fs-5 shadow-sm hover-up">
                            <i class="fa-solid fa-cloud-arrow-up me-2"></i> ƒêƒÉng Tin Ngay
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<script>
    const giaInput = document.getElementById('gia-input');
    const docSoText = document.getElementById('doc-so-tien');
    const form = document.getElementById('form-dang-tin');

    giaInput.addEventListener('input', function(e) {
        let rawValue = this.value.replace(/\D/g, '');
        if (rawValue === '') {
            this.value = '';
            docSoText.innerText = '';
            return;
        }
        let formattedValue = new Intl.NumberFormat('vi-VN').format(rawValue);
        this.value = formattedValue;

        let num = parseInt(rawValue);
        if (num >= 1000000) {
            let trieu = (num / 1000000).toFixed(1).replace('.0', '');
            docSoText.innerText = `üëâ ${trieu} tri·ªáu ƒë·ªìng`;
        } else if (num >= 1000) {
            let nghin = (num / 1000).toFixed(0);
            docSoText.innerText = `üëâ ${nghin} ngh√¨n ƒë·ªìng`;
        } else {
            docSoText.innerText = '';
        }
    });

    form.addEventListener('submit', function(e) {
        let rawValue = giaInput.value.replace(/\./g, ''); 
        giaInput.value = rawValue; 
    });
</script>
{% endblock %}