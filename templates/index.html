{% extends "layout.html" %}

{% block content %}

<section class="hero-section text-center text-white d-flex align-items-center justify-content-center" 
    style="background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80'); height: 400px; background-size: cover; background-position: center;">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3">T√¨m Ph√≤ng Tr·ªç ∆Øng √ù Ngay H√¥m Nay</h1>
        <p class="lead mb-4">H√†ng ng√†n ph√≤ng tr·ªç gi√° r·∫ª, an ninh d√†nh cho sinh vi√™n.</p>
        
        <div class="search-bar bg-white p-2 rounded-pill shadow-lg d-inline-block w-100" style="max-width: 700px;">
            <form action="/" method="GET" class="d-flex">
                <input type="text" name="tu_khoa" class="form-control border-0 rounded-pill px-4 shadow-none" 
                       placeholder="Nh·∫≠p t√™n ƒë∆∞·ªùng, qu·∫≠n, tr∆∞·ªùng h·ªçc..." value="{{ request.args.get('tu_khoa', '') }}">
                <button type="submit" class="btn btn-primary rounded-pill px-4 fw-bold">
                    <i class="fa-solid fa-magnifying-glass"></i> T√¨m ki·∫øm
                </button>
            </form>
        </div>
    </div>
</section>

<div class="container mt-5">
    
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card border-0 shadow-sm p-3 rounded-4">
                <form action="/" method="GET" class="d-flex flex-wrap gap-3 align-items-center">
                    <span class="fw-bold text-secondary"><i class="fa-solid fa-filter"></i> B·ªô l·ªçc:</span>
                    
                    <select name="vi_tri" class="form-select form-select-sm rounded-pill w-auto border-light bg-light" onchange="this.form.submit()">
                        <option value="">üìç T·∫•t c·∫£ v·ªã tr√≠</option>
                        <option value="H√† N·ªôi" {% if request.args.get('vi_tri') == 'H√† N·ªôi' %}selected{% endif %}>H√† N·ªôi</option>
                        <option value="Nam ƒê·ªãnh" {% if request.args.get('vi_tri') == 'Nam ƒê·ªãnh' %}selected{% endif %}>Nam ƒê·ªãnh</option>
                    </select>

                    <select name="muc_gia" class="form-select form-select-sm rounded-pill w-auto border-light bg-light" onchange="this.form.submit()">
                        <option value="">üí∞ T·∫•t c·∫£ m·ª©c gi√°</option>
                        <option value="0-1000000" {% if request.args.get('muc_gia') == '0-1000000' %}selected{% endif %}>D∆∞·ªõi 1 tri·ªáu</option>
                        <option value="1000000-3000000" {% if request.args.get('muc_gia') == '1000000-3000000' %}selected{% endif %}>1tr - 3tr</option>
                        <option value="3000000-5000000" {% if request.args.get('muc_gia') == '3000000-5000000' %}selected{% endif %}>3tr - 5tr</option>
                        <option value="5000000-99999999" {% if request.args.get('muc_gia') == '5000000-99999999' %}selected{% endif %}>Tr√™n 5tr</option>
                    </select>

                    <select name="loai_phong" class="form-select form-select-sm rounded-pill w-auto border-light bg-light" onchange="this.form.submit()">
                        <option value="">üè† T·∫•t c·∫£ lo·∫°i ph√≤ng</option>
                        <option value="Kh√©p k√≠n" {% if request.args.get('loai_phong') == 'Kh√©p k√≠n' %}selected{% endif %}>Kh√©p k√≠n</option>
                        <option value="Chung c∆∞" {% if request.args.get('loai_phong') == 'Chung c∆∞' %}selected{% endif %}>Chung c∆∞ mini</option>
                        <option value="Tr·ªç" {% if request.args.get('loai_phong') == 'Tr·ªç' %}selected{% endif %}>Tr·ªç gi√° r·∫ª</option>
                        <option value="Nguy√™n cƒÉn" {% if request.args.get('loai_phong') == 'Nguy√™n cƒÉn' %}selected{% endif %}>Nguy√™n cƒÉn</option>
                        <option value="KTX" {% if request.args.get('loai_phong') == 'KTX' %}selected{% endif %}>KTX</option>
                    </select>

                    {% if request.args.get('vi_tri') or request.args.get('muc_gia') or request.args.get('loai_phong') %}
                        <a href="/" class="text-danger text-decoration-none small ms-auto fw-bold">‚ùå X√≥a l·ªçc</a>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>

    <h3 class="fw-bold mb-4 ps-2 border-start border-4 border-primary">Ph√≤ng Tr·ªç N·ªïi B·∫≠t</h3>
    
    <div class="row g-4">
        {% if danh_sach %}
            {% for phong in danh_sach %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden card-hover">
                    <div class="position-relative">
                        <img src="/static/images/{{ phong.anh }}" class="card-img-top" alt="·∫¢nh ph√≤ng" style="height: 220px; object-fit: cover;">
                        <span class="position-absolute top-0 end-0 m-3 badge bg-white text-danger shadow-sm rounded-pill">
                            <i class="fa-regular fa-heart"></i>
                        </span>
                        <span class="position-absolute bottom-0 start-0 m-3 badge bg-primary shadow-sm">
                            {{ phong.loai_phong or 'Ph√≤ng tr·ªç' }}
                        </span>
                        {% if phong.status == 'da_thue' %}
                            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(0,0,0,0.6); color: white; font-weight: bold; letter-spacing: 2px;">
                                ƒê√É H·∫æT PH√íNG
                            </div>
                        {% endif %}
                    </div>

                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title fw-bold text-dark text-truncate">{{ phong.ten }}</h5>
                        <p class="card-text text-muted small mb-2">
                            <i class="fa-solid fa-location-dot text-danger me-1"></i> {{ phong.dia_chi }}
                        </p>
                        <div class="mt-auto d-flex justify-content-between align-items-center">
                            <h5 class="text-primary fw-bold mb-0">
                                {{ "{:,.0f}".format(phong.gia|float).replace(",", ".") }} <small class="text-muted fs-6">ƒë/th√°ng</small>
                            </h5>
                        </div>
                    </div>

                    <div class="card-footer bg-white border-0 pt-0 pb-3">
                        <div class="d-grid gap-2 d-md-flex">
                            <a href="/chitiet/{{ phong.id }}" class="btn btn-outline-primary rounded-pill w-100 fw-bold">Xem chi ti·∫øt</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12 text-center py-5">
                <img src="https://cdn-icons-png.flaticon.com/512/7486/7486754.png" width="100" class="mb-3 opacity-50">
                <h5 class="text-muted">Kh√¥ng t√¨m th·∫•y ph√≤ng n√†o ph√π h·ª£p.</h5>
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}